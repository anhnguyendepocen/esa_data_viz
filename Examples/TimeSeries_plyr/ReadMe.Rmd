Time series and ``plyr`` example
========================================================

This is an example of how to make a time series plot using ``ggplot2`` with data processed using ``plyr``. The plot semi-reproduces Figure 1 in Adler et al. 2009, _Ecology_ (http://www.esajournals.org/doi/full/10.1890/08-2241.1). The data is freely available on _Ecological Archives_ (http://esapubs.org/archive/ecol/E091/243/default.htm).

There are two versions of this example: 1) a 'Harder' example using the raw dataset with lots of ``plyr`` usage, and 2) an 'Easier' example using a cleaned-up version of the dataset with more limited use of ``plyr``. Both versions produce the same plot via the same ``ggplot2`` commands.

Geoms and other ``ggplot2`` commands used
---------------------------
* ``geom_point`` (``shape`` by category)
* ``geom_line`` (``linetype`` by category)
* ``theme()``

Libraries required
---------------------------
* ``ggplot2``
* ``grid``
* ``plyr``
* ``RCurl``

Plot produced
------------------------------------------


```{r fig.width=5, fig.height=4, echo=FALSE, results='hide',message=FALSE}
rm(list=ls())
#Depends: libraries 'plyr' and 'ggplot2'
# install.packages(pkgs=c("plyr", "ggplot2"), dependencies=TRUE)
require(RCurl)
url <- "https://raw.github.com/karthikram/esa_data_viz/master/Examples/TimeSeries_plyr/Easier/AdlerIdahoData_Dominants.csv"
file <- getURL(url)

data <- read.csv(textConnection(file))
#Convert 'data' to data frame for working with 'plyr' and 'ggplot2'
data <- as.data.frame(data)

require(plyr)
#Average the cover over quads for each species, each year
quadout.df <- ddply(data, .(year, species), summarise,
               avg = mean(cover))

##Plot dominant species average cover through time
#Make linetype and shape vary by species, and add a gap between the line and datapoints
#by having two calls for geom_point (one white and larger than the the actual points to be plotted)
require(ggplot2)
require(grid)
ggplot(data=quadout.df, aes(x=year, y=(avg*100), linetype=species, shape=species)) +
  geom_line(color="grey45") +
  geom_point(color="white", size=4) +
  geom_point(size=2) +
  theme_bw() +
  xlab("Year (19xx)") + ylab("Mean Cover (%)") +
  theme(axis.title.x = element_text(size=14),
        axis.title.y = element_text(size=14, angle=90),
        axis.text.x = element_text(size=12),
        axis.text.y = element_text(size=12),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.position = c(0.25,0.85),
        legend.title = element_blank(),
        legend.key = element_blank(),
        legend.text=element_text(size=8, face="italic"),
        legend.background = element_rect(colour = NA),
        legend.key.height = unit(1, "mm")
  ) 
```

