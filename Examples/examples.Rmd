# Additional ggplot2 examples.
Here are several more example plots you can do with ggplot2.

* Distributions
* Error bars
* X-Y Scatter Allmetry
* Time Series

---

```{r, libraries}
# First we load up all the relevant libraries
library(ggplot2)
library(ggthemes)
library(grid)
library(gridExtra)
library(plyr)
library(scales)
```


```{r setup, include = FALSE}
opts_chunk$set(fig.cap="")
```

# Overlapped distributions example

This is an example of how to make overlapping, transparent distributions using ggplot2. The data is fake, and just simulated within the code.



```{r distributions, warning = FALSE}
dt <- rnorm(50, 2, 0.5)
dt2 <- rnorm(50, 3, 0.5)
dt.all <- c(dt, dt2)
sp <- c("SP1", "SP2")
data <- data.frame(species = factor(rep(sp, each = 50)), var1=dt.all)

# The color-blind palette with grey:
cbPalette <- c("#999999", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")

ggplot(data, aes(x = var1, fill = species)) + 
  geom_density(alpha = 0.2) + 
  xlab(expression(beta)) + ylab("posterior density") +
  theme_bw() +
  scale_fill_hue(l = 40) +
  scale_x_continuous(limits = c(0,4)) +
  theme(axis.title.x = element_text(size = 20),
      axis.title.y = element_text(size = 20, angle =90), 
      axis.text.x = element_text(size = 14), 
      axis.text.y = element_text(size = 14), 
      panel.grid.major = element_blank(),
      panel.grid.minor = element_blank()
  )
```
---

# Error Bars

This R script shows an example of how to make grouped bar plots with error bars using ggplot2 
Also shows great use of 'plyr' for summarizing data

```{r, error_bars, warning = FALSE}
#read in data (change 'datafile' to match your computer)
datafile <- "../data/GrazingData.csv"
data <- read.csv(file=datafile, header=TRUE)
head(data)
#remove 'X' column
data <- data[,2:4]
head(data)

df.avg <- ddply(data, .(grazed, nutadd), summarize,
                mean.biomass = mean(biomass), 
                sd.biomass = sd(biomass))


#The bars and the errorbars will have different widths, so...
#we need to specify how wide the objects we are dodging are
dodge <- position_dodge(width=0.9)

#Create a sophisticated label for the y-axis
y.label <- expression(paste("Biomass (g ", m^-2, ")"))

#now start the plot
myplot <- ggplot(data=df.avg, aes(y=mean.biomass, x=grazed, fill=nutadd)) +
#adds the bars
 geom_bar(position=dodge, stat="identity") + 
 #adds the errorbars by adding/subtracting std. devs.
  geom_errorbar(position=dodge, aes(ymin=(mean.biomass-sd.biomass), 
                                    ymax=(mean.biomass+sd.biomass)),
                width=0.15)+ 
  #adds desired x and y axis labels
  ylab(y.label) + xlab("Grazing Treatment") + 
  #desired labels for x axis
  scale_x_discrete(labels=c("Not Grazed", "Grazed")) + 
  scale_fill_grey(start=0.5, end=0.8,
  	#set colors and labels for bar groups
labels = c("Nutrient Added", "No Nutrient Added")) + 
  #set theme from 'ggthemes'
  theme_classic() + 
  
  #add extra theme modifications
  theme(legend.position = c(0.75,0.9), #position legend in plot
        legend.title = element_blank(), #no legend title
        legend.key = element_blank(), #no legend ky
        legend.background = element_rect(colour = NA), #no legend background color
        legend.key.height = unit(5, "mm") #set height of legend (requires 'grid' library)
  ) 

#print plot to window
myplot

#save the plot as a pdf (change file variable first)
file = "../data/Grazing.pdf"
ggsave(filename=file, plot=myplot, width=4, height=4, units="in")
```

---

# x-y scatterplot plot

This is an example of how to make a x-y scatterplot plot with linear model trend lines using ``ggplot2``. The plot semi-reproduces Figure 1 in Tredennick et al. 2013, _PLoS One_ (http://www.plosone.org/article/info%3Adoi%2F10.1371%2Fjournal.pone.0058241). The data is freely available on _Dryad_ (http://datadryad.org/resource/doi:10.5061/dryad.4s1d2).

The data contains measurements of biomass (total, stem, and leaf), length, and diameter for individual branches from savanna trees. Each observation is a branch, coded by species and tree. Here we'll just plot each observation by species and include a linear model fit for each species. We'll do two plots (diameter vs. length and diameter vs. total mass) and put them side-by-side for a publication-ready figure.

Geoms and other ``ggplot2`` commands used
---------------------------
* ``geom_point`` (``shape`` and ``color`` by category)
* ``geom_text``
* ``stat_line`` (``color`` by category)
* ``scale_colour_manual``
* ``scale_fill_manual``
* ``scale_y_log10`` and ``scale_x_log10``
* ``theme()``
* ``grid.arrange`` from the ``gridExtra``

```{r, scatter, warning = FALSE}
scatter_data <- read.csv("../data/AllometryData_Tredennick2013.csv")

names(scatter_data) <- tolower(names(scatter_data)) #change col names to lower case
scatter_data = scatter_data[scatter_data$aggregated_leaf_wt>-9000,] #take out bad data

scatter_data <- as.data.frame(scatter_data) #make it a data frame
head(scatter_data) #look at first lines


#Make a plot of diameter vs. length
length.plot <- ggplot(data=scatter_data, aes(x=diameter, y=length)) +
  geom_point(alpha=0.5, size=3, aes(color=spp, shape=spp)) +
  stat_smooth(method="lm", aes(color=spp, shape=spp, fill=spp)) + #add linear model fit and 95% CI
  scale_colour_manual(values = c("black", "darkorange", "steelblue")) + #set line and point colors
  scale_fill_manual(values = c("black", "darkorange", "steelblue")) + #set fill colors to match
  scale_y_log10(breaks = trans_breaks("log10", function(x) 10^x),
                labels = trans_format("log10", math_format(10^.x))) + #make log-log scale
  scale_x_log10(breaks = trans_breaks("log10", function(x) 10^x),
                labels = trans_format("log10", math_format(10^.x))) + #make log-log scale
  xlab("Diameter (cm)") + ylab("Branch Length (cm)") +
  geom_text(aes(2,2000,label = "A")) + #add text for panel ID
  theme_few() +
  theme(axis.title.x = element_text(size=14),
        axis.title.y = element_text(size=14, angle=90), 
        axis.text.x = element_text(size=12), 
        axis.text.y = element_text(size=12), 
        legend.position = c(0.72,0.2),
        legend.title = element_blank(),
        legend.key = element_blank(),
        legend.text=element_text(size=10, face="italic"),
        legend.background = element_rect(colour = NA),
        legend.key.height = unit(5, "mm"))

#make a plot of diameter vs. mass
mass.plot <- ggplot(data=scatter_data, aes(x=diameter, y=total_mass)) +
  geom_point(alpha=0.5, size=3, aes(color=spp, shape=spp)) +
  stat_smooth(method="lm", aes(color=spp, shape=spp, fill=spp)) + #add linear model fit and 95% CI
  scale_colour_manual(values = c("black", "darkorange", "steelblue")) + #set line and point colors
  scale_fill_manual(values = c("black", "darkorange", "steelblue")) + #set fill colors to match
  scale_y_log10(breaks = trans_breaks("log10", function(x) 10^x),
                labels = trans_format("log10", math_format(10^.x))) + #make log-log scale
  scale_x_log10(breaks = trans_breaks("log10", function(x) 10^x),
                labels = trans_format("log10", math_format(10^.x))) + #make log-log scale
  xlab("Diameter (cm)") + ylab("Branch Mass (g)") +
  geom_text(aes(2,100000,label = "B")) + #add text for panel ID
  theme_few() +
  theme(axis.title.x = element_text(size=14),
        axis.title.y = element_text(size=14, angle=90), 
        axis.text.x = element_text(size=12), 
        axis.text.y = element_text(size=12)) +
  guides(shape=FALSE, color=FALSE, fill=FALSE) #removes legend from second plot


final.fig <- grid.arrange(length.plot, mass.plot, ncol = 2)
final.fig
```
